<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout.html}">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <section layout:fragment="content">
        <div class="card">
            <div class="card-header text-center">
                <h5>Cadastro de Novo Usuário</h5>
            </div>
            <div class="card-body">
                <form class="row g-3" th:object="${usuario}" th:action="@{/usuarios/save}" method="post" enctype="multipart/form-data" id="frm">
                    <input type="hidden" th:field="*{id}">
                    
                    <div class="col-6 mb-3">
                        <label for="nome" class="form-label">Nome</label>
                        <input type="text" id="nome" class="form-control form-control-sm" th:field="*{nome}" placeholder="">
                    </div>
                    <div class="col-6 mb-3">
                        <label for="cpf" class="form-label">CPF</label>
                        <input type="text" id="cpf" class="form-control form-control-sm" th:field="*{cpf}" placeholder="">
                    </div>
                    
                    <div class="col-4 mb-3">
                        <label for="nickname" class="form-label">NickName</label>
                        <input type="text" id="nickname" class="form-control form-control-sm" th:field="*{nickname}" placeholder="">
                    </div>
                    
                    <div class="col-4 mb-3">
                        <label for="servidor" class="form-label">Servidor</label>
                       <select id="servidor" class="form-select form-select-sm" th:field="*{servidorId.id}" > 
						       <option th:text="${'Selecione o Servidor'}" th:value="${'0'}">	
						       <option th:each="servidor : ${servidores}" th:text="${servidor.nome}" th:value="${servidor.id}">		       
		    		  </select>
		      
                    </div>
                    
                     <div class="col-4 mb-3">
                        <label for="servidor" class="form-label">Lotação</label>
                       <select id="lotacat" class="form-select form-select-sm" th:field="*{lotacao_id}" > 
						       <option th:text="${'Selecione a Lotação'}" th:value="${'0'}">	
						      <option th:each="setor : ${setores}" th:text="${setor.nome}" th:value="${setor.id}">		    
		    		  </select>		      
                    </div>                   
               
                    
                    <div class="col-4 mb-3">
                        <label for="senha" class="form-label">Senha</label>
                        <input type="password" id="senha" class="form-control form-control-sm" th:field="*{senha}">
                        <span class="text-danger d-block mt-2">Atenção: a senha é de uso pessoal e intransferível</span>
                    </div>
                    
                    <div class="col-4 mb-3">
                        <label for="servidor" class="form-label">Perfil</label>
                       <select id="perfil" class="form-select form-select-sm" th:field="*{perfilId}" > 
						       <option th:text="${'Selecione o Peril'}" th:value="${'0'}">	
						       <option value="1">Operador</option>	
						       <option value="2">Moderador</option>	
						       <option value="3">Administrador</option>		       
		    		  </select>		      
                    </div>
                    
                    <div class="col-4 mb-3">
                        <label for="certificado" class="form-label">Certificado</label>
                        <input type="text" id="certificado" class="form-control form-control-sm" th:field="*{certificado}">
                    </div>                    
                    
                    <div class="col-6 mb-3">
                        <label for="image" class="form-label">Foto de Perfil</label>
                        <div class="d-flex align-items-center mb-3">
                            <img id="profileImage" src="/images/male.png" alt="Profile Image" class="rounded-circle me-3" width="50" height="50">
                            <select id="iconSelect" class="form-select me-3">
                                <option value ="/images/male.png">Ícone Masculino</option>  
                                <option value="/images/female.png">Ícone Feminino</option>
                            </select>
                            <input type="file" id="imageUpload" name="file" class="form-control" >
                        </div>
                        <input type="hidden" id="imagePath" th:field="*{image}">
                    </div>
                    
                    <div class="col-12">
                        <button type="submit" id="salvar" class="btn btn-primary btn-sm">Salvar</button>
                        <button type="button" id="voltar" class="btn btn-success btn-sm">Voltar</button>
                    </div>
                </form>
            </div>
        </div>
    </section>
    <div layout:fragment="jscript">
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script type="text/javascript">
            var URL = '[[@{/}]]';
            $("#loader").show();
            $(document).ready(function() {
                $("#loader").hide();

                $('#iconSelect').change(function() {
                    var selectedIcon = $(this).val();
                    $('#profileImage').attr('src', selectedIcon);
                    $('#imagePath').val(selectedIcon);
                });

                $('#imageUpload').change(function(event) {
                    var reader = new FileReader();
                    reader.onload = function(e) {
                        $('#profileImage').attr('src', e.target.result);
                        $('#imagePath').val(e.target.result);
                    }
                    reader.readAsDataURL(event.target.files[0]);
                });

                $("#salvar").click(function(event) {
                    event.preventDefault();
                    swal({
                        title: 'Salvar?',
                        text: "Deseja salvar novo Usuário?",
                        icon: 'warning',
                        buttons: [true, "Sim Salvar!"]
                    }).then((result) => {
                        if (result) {
                            $("#frm").submit();
                        }
                    });
                });
            });            
            
            
          document.getElementById("voltar").addEventListener("click", () => {
          	  history.back();
          });
            
            
        </script>
    </div>
</body>
</html>
